<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Ludo RL Lab</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
<header>
    <h1>Ludo Reinforcement Learning Lab</h1>
    <p>Experiment with dice sizes, power squares, and training hyper-parameters to discover fast-to-finish rule sets.</p>
</header>

<main>
    {% if error %}
        <div class="error">{{ error }}</div>
    {% endif %}

    <form action="/simulate" method="post" class="config-form">
        <section>
            <h2>Board Setup</h2>
            <label>Board size
                <input max="32" type="number" name="board_size" min="10" value="{{ config.board_size }}" required>
            </label>
            <label>Number of players
                <input type="number" name="num_players" min="1" max="4" value="{{ config.num_players }}" required>
            </label>
            <label>Pawns per player
                <input type="number" name="num_pawns" min="1" value="{{ config.num_pawns }}" required>
            </label>
            <label>Dice sides
                <input type="number" name="dice_sides" min="2" value="{{ config.dice_sides }}" required>
            </label>
            <label>Power squares (comma separated)
                <input type="text" name="power_squares" value="{{ config.power_squares | join(', ') }}">
            </label>
            <label>Power bonus
                <input type="number" name="power_bonus" min="0" value="{{ config.power_bonus }}">
            </label>
            <label>Shortcut squares (square:steps forward)
                <input type="text" name="shortcut_squares" value="{{ shortcut_string | default('') }}">
            </label>
            <label>Construction zones (square:steps backward)
                <input type="text" name="construction_zones" value="{{ construction_string | default('') }}">
            </label>
            <label>Max turns per episode
                <input type="number" name="max_turns" min="50" value="{{ config.max_turns }}">
            </label>
            <label class="checkbox">
                <input type="checkbox" name="allow_odd_split" {% if config.allow_odd_split %}checked{% endif %}>
                Allow odd dice rolls to be split between two pawns
            </label>
            <label class="checkbox">
                <input type="checkbox" name="enable_capture" {% if config.enable_capture %}checked{% endif %}>
                Allow captures (landing on another pawn sends it back to base)
            </label>
            <p class="tip">Remember: you must roll a 6 to launch a pawn out of its base. Choose a board size that is divisible by the number of players so their starting squares stay evenly spaced.</p>
        </section>

        <section>
            <h2>Training Hyper-parameters</h2>
            <label>Episodes
                <input type="number" name="episodes" min="10" value="{{ config.episodes }}" required>
            </label>
            <label>Evaluation runs
                <input type="number" name="evaluation_runs" min="5" value="{{ config.evaluation_runs }}" required>
            </label>
            <label>Learning rate (alpha)
                <input type="number" step="0.01" name="alpha" value="{{ config.alpha }}">
            </label>
            <label>Discount (gamma)
                <input type="number" step="0.01" name="gamma" value="{{ config.gamma }}">
            </label>
            <label>Exploration (epsilon)
                <input type="number" step="0.01" name="epsilon" value="{{ config.epsilon }}">
            </label>
            <label>Min epsilon
                <input type="number" step="0.01" name="min_epsilon" value="{{ config.min_epsilon }}">
            </label>
            <label>Epsilon decay
                <input type="number" step="0.001" name="epsilon_decay" value="{{ config.epsilon_decay }}">
            </label>
        </section>

        <button type="submit" id="submit-btn">Run Simulation</button>
    </form>
</main>

<!-- Loading Overlay -->
<div id="loading-overlay" class="loading-overlay" style="display: none;">
    <div class="loading-content">
        <div class="rl-animation">
            <div class="neural-network">
                <div class="node node-1"></div>
                <div class="node node-2"></div>
                <div class="node node-3"></div>
                <div class="node node-4"></div>
                <div class="node node-5"></div>
                <div class="node node-6"></div>
                <div class="connection conn-1"></div>
                <div class="connection conn-2"></div>
                <div class="connection conn-3"></div>
                <div class="connection conn-4"></div>
                <div class="connection conn-5"></div>
                <div class="connection conn-6"></div>
            </div>
            <div class="agent-path">
                <div class="path-dot dot-1"></div>
                <div class="path-dot dot-2"></div>
                <div class="path-dot dot-3"></div>
                <div class="path-dot dot-4"></div>
                <div class="path-dot dot-5"></div>
            </div>
        </div>
        <h2>Training Agent...</h2>
        <p class="loading-text">Running Q-Learning simulation</p>
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
    </div>
</div>

<script>
    document.querySelector('.config-form').addEventListener('submit', function(e) {
        document.getElementById('loading-overlay').style.display = 'flex';
        document.getElementById('submit-btn').disabled = true;
    });
</script>
</body>
</html>
